$(document).ready(function(){$(":checkbox").checkbox();$(".has-tooltip").tooltip();var g=$(".slider");jQuery("span.timeago").timeago();var h='"We are no longer the knights who say ni! We are now the knights who say ekki-ekki-ekki-pitang-zoom-boing!";"We apologise for the fault in the subtitles. Those responsible have been sacked.";"Is the video that big or your connection just sucks ? O.O";"Wi not trei a holiday in Sweeden this yer ?";"A moose once bit my sister...";"Are you sure you\'re not an encyclopedia salesman? No, Ma\'am. Just a burglar, come to ransack the flat.";"Mate, this parrot wouldn\'t VOOM if you put four million volts through it! "'.split(";"),
k=function(){return Math.floor(7*Math.random())},l=function(a,b){window.setTimeout(function(){alertify.success(a,8E3)},b)},v=function(){l(h[k()],15E3);l(h[k()],3E4);l(h[k()],6E4);l(h[k()],9E4);l(h[k()],12E4);l(h[k()],18E4);l(h[k()],3E5)};0<g.length&&(g.slider({min:0,max:3,value:0,orientation:"horizontal",range:"min"}),$(document).on("mousedown",".slider",function(){$("body").mouseup(function(){$("input[name='difficulty']").val(g.slider("option","value"));$(this).off("mouseup")})}));var q=$(".ui-block");
$(window).on("resize",function(){q.css("height",q.width()/1.2)});$(document).ajaxError(function(){alertify.error("An unexpected error occurred. Please try again...");NProgress.done()});q.find("a").click(function(a){a.preventDefault()});q.click(function(){"share-block"!=$(this).attr("id")&&($(this).parents("#wrapper").height($(this).parents("#wrapper").height()),$(this).toggleClass("active"),$(this).siblings().not(this).toggleClass("hide"),$(this).fadeOut(1500,function(){var a=$("#"+$(this).attr("id")+
"-body");$(this).removeClass("active");a.removeClass("hide");a.fadeIn(1E3);a.find(".back-action").removeClass("real-back-action");$(this).parents("#wrapper").removeAttr("style")}))});$("select").selectpicker({style:"btn-hg btn-info",menuStyle:"dropdown-inverse"});$(".input-group").on("focus",".form-control",function(){$(this).closest(".input-group, .form-group").addClass("focus")}).on("blur",".form-control",function(){$(this).closest(".input-group, .form-group").removeClass("focus")});$(document).on("click",
".real-back-action",function(a){window.history.back();a.preventDefault()});var w=function(a,b){var c="";$.each(a,function(d){var e=a[d].creator.username;a[d].creator.firstName&&(e=a[d].creator.firstName+" "+a[d].creator.lastName.substring(0,3));c+='<tr><td class="profilePicTd"><a href="'+jsRoutes.controllers.Application.showProfile(a[d].creator.username).url+'">';for(var f=c=void 0!=a[d].creator.profilePictureUrl?c+('<img class="smallProfilePicture" src="'+a[d].creator.profilePictureUrl+'"/>'):c+
'<img src="/assets/images/avatar_small.png"/>',e=e+'</a></td><td><a href="'+jsRoutes.controllers.Application.showChallenge(a[d].id).url+'">'+a[d].challengeName+"</a></td><td>",m=a[d].rating,n="",r=0;5>r;r++)n=.3>=m-r?n+' <a class="rating-star"></a>':.8<=m-r?n+' <a class="rating-star full-star"></a>':n+' <a class="rating-star half-star"></a>';c=f+(e+n+"</td><td>"+["easy","medium","hard","insane"][a[d].difficulty]+"</td><td>");a[d].creator.username!=b&&(c+='<input type="button" class="btn btn-hg btn-success browse-challenge-join-action" value="Join"/><input class="challenge-id" type="hidden" value="'+
a[d].id+'"/>');c+="</td></tr>"});return c},p=function(a){var b=$("form.browse-challenges-form").find("input.challenge-search-phrase").val(),c=$(".challenge-category").val(),d=$(".current-username").val(),e=$("input[name='search-scope']:checked",".browse-challenges-form").val();NProgress.start();jsRoutes.controllers.Application.ajaxGetChallengesForCriteria(b,c,a,e).ajax({success:function(a){a=jQuery.parseJSON(a);a=w(a,d);$(".challenge-search-results table tbody").html(a);NProgress.done()}})};$(".browse-challenges-form").submit(function(a){p(0);
x();a.preventDefault()});$(document).on("click",".browse-page-action",function(a){var b=$("div.pagination").find("li.active");y(b);var c=$(this).parents("li");c.hasClass("disabled")||c.hasClass("active")||(p($(this).index(".browse-page-action")),b.removeClass("active"),$(this).parents("li").addClass("active"));a.preventDefault()});$(document).on("click","li.previous",function(a){var b=$("div.pagination").find("li.active");0<b.index("li.page-index")&&(p(b.index(".page-index")-1),b.removeClass("active"),
b.prev(".page-index").addClass("active"));a.preventDefault()});$(document).on("click","li.next",function(a){var b=$("div.pagination").find("li.active");y(b);8>b.index("li.page-index")&&!$(this).hasClass("disabled")&&(p(b.index(".page-index")+1),b.removeClass("active"),b.next(".page-index").addClass("active"));a.preventDefault()});var y=function(a){var b=$("div.pagination");a=b.find("li.active");b=b.find("li.next");10>$(".challenge-search-results").find("tbody tr").length?(a.nextAll("li.page-index").addClass("disabled"),
b.addClass("disabled")):b.removeClass("disabled")},x=function(){var a=$("div.pagination"),b=a.find("li");b.removeClass("disabled");b.removeClass("active");a.find("li.page-index").first().addClass("active")};$("#browse-block").click(function(a){var b=$(".current-username").val();NProgress.start();jsRoutes.controllers.Application.ajaxGetLatestChallenges().ajax({success:function(a){a=jQuery.parseJSON(a);a=w(a,b);$(".challenge-search-results table tbody").html(a);$(".switch").bootstrapSwitch();NProgress.done()}});
a.preventDefault()});$(document).on("click",".browse-challenge-join-action",function(){NProgress.start();var a=$(this),b=a.parents("td"),c=b.find(".challenge-id").val();jsRoutes.controllers.Application.ajaxJoinChallenge(c).ajax({success:function(c){a.remove();b.append('<input type="button" class="btn btn-hg btn-danger browse-challenge-leave-action" value="Leave"/>');alertify.success("You joined the competition!");NProgress.done()}})});$(document).on("click",".browse-challenge-leave-action",function(){var a=
$(this),b=a.parents("td"),c=b.find(".challenge-id").val();NProgress.start();jsRoutes.controllers.Application.ajaxLeaveChallenge(c).ajax({success:function(c){a.remove();b.append('<input type="button" class="btn btn-hg btn-success browse-challenge-join-action" value="Join"/>');alertify.error("You left the competition...");NProgress.done()}})});$(document).on("click",".challenge-details-leave-action",function(){var a=$("#content-wrapper").find(".challenge-id").val();alertify.confirm("Are you sure you want to leave this challenge ?",
function(b){b&&(NProgress.start(),jsRoutes.controllers.Application.ajaxLeaveChallenge(a).ajax({success:function(a){window.location.href=jsRoutes.controllers.Application.showMyParticipations().url;NProgress.done()}}))})});var z=$("<div/>").css({height:0,width:0,display:"none"}),A=$(":file"),B=A.wrap(z);B.change(function(){var a=$(this);""!=a.val()?$("#video-input-wrapper").html('<div id="video-screenshot">'+a.val().replace(/.*(\/|\\)/,"")+'<img src="/assets/images/correct.png"/></div>'):$("#video-input-wrapper").html('<button id="upload-video-action" type="button" class="btn btn-warning btn-hg">Upload a video description...</button>')});
var C=A.wrap(z);$("#video-input-wrapper").click(function(){B.click()}).show();C.change(function(){var a=$(this);""!=a.val()?$("#upload-response-wrapper").html('<div id="video-screenshot">'+a.val().replace(/.*(\/|\\)/,"")+'<img src="/assets/images/correct.png"/></div>'):$("#upload-response-wrapper").html('<button type="button" class="btn btn-warning">Submit a response.</button>')});$("#upload-response-wrapper").click(function(){C.click()}).show();$("#create-challenge-form").submit(function(a){a.preventDefault();
a=!1;$("#challengeName").val()?5>$("#challengeName").val().length&&(alertify.error("Challenge name should be at least 5 characters long. Just because :P"),a=!0):(alertify.error("You forgot to type the challenge name, you know..."),a=!0);$("input[name='video-description']").val()||(alertify.error("Upload a video description..."),a=!0);0==$(".friend-item").size()&&0==$("#challenge-visibility").val()&&(alertify.error("You didn't select any of your friends. Challenge someone or make the challenge public."),
a=!0);a||(NProgress.start(),$(this).ajaxSubmit({success:function(a){var c=jQuery.parseJSON(a);if(c.hasOwnProperty("status"))0<c.rewardedPoints&&t(c.messages,c.points),alertify.alert("Challenge created and ready to join ! ",function(a){a&&(window.location="/")});else{var d=jQuery.parseJSON(a);$.each(d,function(a){var b=d[a];$.each(b,function(a){alertify.error(b[a].message)})})}NProgress.done()}}),v())});$("#challenge-visibility").change(function(){if(0==$(this).val()){var a=[];$(".friend-item").each(function(){var b=
$(this).find(".selected-user-data").val().split(",");a.push(b[0])});FB.ui({method:"apprequests",message:"I created a challenge! Will you be able to complete it ? ;]",exclude_ids:a},function(a){void 0==a||jQuery.isEmptyObject(a)||a.error_code?$("#challenge-participants-wrapper").show():(NProgress.start(),jsRoutes.controllers.Application.ajaxGetFacebookUsers(a.to.join()).ajax({success:function(a){var b=jQuery.parseJSON(a),e="";$.each(b,function(a){e+='<div class="friend-item"><a href="#"><img class="smallProfilePicture" src="'+
b[a].picture+'"/><span class="friends-name">'+b[a].name+'</span></a><input class="selected-user-data" type="hidden" name="participants[]" value="'+b[a].id+","+b[a].firstName+","+b[a].lastName+","+b[a].picture+'"/><a class="remove-selected" href="#"><img src="/assets/images/close.png"/></a></div>'});$(".challenge-participants-div").html(e);$(":checkbox").checkbox();$("#challenge-participants-wrapper").show();NProgress.done()}}))})}else $("#challenge-participants-wrapper").hide()});$(document).on("click",
".remove-selected",function(a){$(this).parents(".friend-item").remove();a.preventDefault()});$(".challenge-category").change(function(){p(0);x()});$("#friends-filter-input").keyup(function(a){var b=$(this).val().toLowerCase().replace(/\s+/g,"");3<=b.length?8==a.keyCode?$(".friend-item:hidden").each(function(){0<=$(this).find(".friends-name").text().toLowerCase().replace(/\s+/g,"").indexOf(b)&&$(this).show()}):$(".friend-item:visible").each(function(){0>$(this).find(".friends-name").text().toLowerCase().replace(/\s+/g,
"").indexOf(b)&&$(this).hide()}):$(".friend-item:hidden").show()});$(document).on("change",".challenge-status",function(){var a=$(this),b=a.parents(".switch").find(".challenge-id").val();$(this).is(":checked")||alertify.confirm("Are you sure you want to complete the challenge ? Successful responses will be rewarded with points immediately.",function(c){c?(NProgress.start(),jsRoutes.controllers.Application.ajaxCloseChallenge(b).ajax({success:function(a){$("#challenges-created").spin(!1);NProgress.done()}})):
a.parents(".switch").bootstrapSwitch("toggleState")})});$(".close-window").click(function(a){a.preventDefault()});$(document).on("click",".decline-response",function(){var a=$(this).siblings(".response-id").val(),b=$(this).parents(".rate-response");NProgress.start();jsRoutes.controllers.Application.ajaxDeclineResponse(a).ajax({success:function(c){c=jQuery.parseJSON(c);"success"==c.status&&(NProgress.done(),b.fadeOut(1200),$(".response-id[value='"+a+"']").parents(".rate-response").fadeOut(1200),0<
c.rewardedPoints&&t(c.messages,c.points))}})});$(document).on("click",".accept-response",function(){var a=$(this).siblings(".response-id").val(),b=$(this).parents(".rate-response");NProgress.start();jsRoutes.controllers.Application.ajaxAcceptResponse(a).ajax({success:function(c){c=jQuery.parseJSON(c);"success"==c.status&&(NProgress.done(),b.fadeOut(1200),$(".response-id[value='"+a+"']").parents(".rate-response").fadeOut(1200),0<c.rewardedPoints&&t(c.messages,c.points))}})});$(document).on("click",
".leave-challenge",function(){var a=$(this).siblings(".challenge-id").val(),b=$(this).parents("tr");alertify.confirm("Are you sure you want to forfeit this challenge ?",function(c){c&&(NProgress.start(),jsRoutes.controllers.Application.ajaxLeaveChallenge(a).ajax({success:function(a){b.remove();NProgress.done()}}))})});$(".close-window-upper-div").click(function(a){a.preventDefault();$(".active-participation").removeClass("active-participation");$(this).parent().parent().hide()});$(document).on("click",
".show-upload-response",function(){$("#upload-response-wrapper").html('<button type="button" class="btn btn-warning btn-hg">Upload a video response...</button>');$("#send-response-wrapper").show()});$("#upload-response-form").submit(function(a){a.preventDefault();a=!1;$("input[name='video-description']").val()||(alertify.error("You need to choose a video response..."),a=!0);a||(NProgress.start(),v(),$(this).ajaxSubmit({success:function(a){var c=jQuery.parseJSON(a);if(c.hasOwnProperty("status")){a=
$(".active-participation");var d=a.find(".leave-challenge").parents("td"),e=$(".rating-star");$("#send-response-wrapper").hide();a.find(".leave-challenge").remove();a.find(".show-upload-response").remove();$(".show-upload-response").parents("span").remove();$(".challenge-details-name-wrapper").append('<span><img src="/assets/images/correct.png"></span>');$(".timer-parent").remove();d.html('<img src="/assets/images/done.png"/>');alertify.alert("Response send!");e.parents("div").tooltip("show");e.addClass("active-rating-star");
$(".challenge-details-leave-action").remove();0<c.rewardedPoints&&t(c.messages,c.points)}else{var f=jQuery.parseJSON(a);$.each(f,function(a){var b=f[a];$.each(b,function(a){alertify.error(b[a].message)})})}NProgress.done()}}))});$(document).on("click",".stop-player",function(a){_V_("video-response-player").pause();a.preventDefault()});$(".show-challenges").click(function(a){$(this).parents(".challenges-body").effect("bounce",300);0==$("#my-challenges-wrapper").size()?$(".account-content:visible").effect("drop",
600,function(){NProgress.start();$("#my-challenges-wrapper").effect("slide",500);jsRoutes.controllers.Application.ajaxGetChallengesContent().ajax({success:function(a){NProgress.done();$("#content-wrapper").append(a);$(".has-tooltip").tooltip()}})}):0==$("#my-challenges-wrapper:visible").size()&&$(".account-content:visible").effect("drop",600,function(){$("#my-challenges-wrapper").effect("slide",500)});a.preventDefault();a.stopPropagation()});$(".show-participations").click(function(a){$(this).parents(".challenges-body").effect("bounce",
300);0==$("#participations-wrapper").size()?$(".account-content:visible").effect("drop",600,function(){NProgress.start();$("#participations-wrapper").effect("slide",500);jsRoutes.controllers.Application.ajaxGetParticipationsContent().ajax({success:function(a){NProgress.done();$("#content-wrapper").append(a);$(".counter").each(function(){var a=$(this).parents(".padded-glyph-challenge").find(".time-left").val();$(this).FlipClock(a,{countdown:!0})});$(".has-tooltip").tooltip()}})}):0==$("#participations-wrapper:visible").size()&&
$(".account-content:visible").effect("drop",600,function(){$("#participations-wrapper").effect("slide",500)});a.preventDefault();a.stopPropagation()});$(document).on("click",".show-profile",function(a){$(this).parent();0==$("#profile-wrapper").size()?$(".account-content:visible").effect("drop",600,function(){NProgress.start();$("#profile-wrapper").effect("slide",500);jsRoutes.controllers.Application.ajaxGetCurrentProfileContent().ajax({success:function(a){NProgress.done();$("#content-wrapper").append(a)}})}):
0==$("#profile-wrapper:visible").size()&&$(".account-content:visible").effect("drop",600,function(){$("#profile-wrapper").effect("slide",500)});a.preventDefault();a.stopPropagation()});$(document).on("click",".join-challenge-action",function(){var a=$(this),b=a.parents("span"),c=$("#challenge-details").find(".challenge-id").val();NProgress.start();jsRoutes.controllers.Application.ajaxJoinChallenge(c).ajax({success:function(c){a.remove();b.html('<input type="button" class="btn btn-hg btn-warning show-upload-response" value="Respond"/>');
NProgress.done();alertify.success("You joined the competition!")}})});$(document).on("click",".remove-participant",function(){var a=$(this).parents("tr"),b=a.find(".participant-username").val(),c=$(".current-challenge-id").val(),d=$(this).parents("tr").find(".participant-name-span").text();alertify.confirm("Are you sure you want to remove "+d+" from this challenge ?",function(e){e&&(NProgress.start(),jsRoutes.controllers.Application.ajaxRemoveParticipantFromChallenge(c,b,d).ajax({success:function(b){a.remove();
NProgress.done();alertify.success(d+" was dismissed from the challenge.")}}))})});$(".quick-search-action").click(function(){var a=$(".challenge-search-phrase").val();a.trim()?window.location.href=jsRoutes.controllers.Application.showBrowseChallengesWithData(a).url:window.location.href=jsRoutes.controllers.Application.showBrowseChallenges().url});$(".go-to-step-two").click(function(){$(".step-one-arrow").show("blind",500,function(){$(".step-two-block").show("blind",500)})});$(".go-to-step-three").click(function(){$(".step-two-arrow").show("blind",
500,function(){$(".step-three-block").show("blind",500)})});$(".counter").each(function(){var a=$(this).parents(".timer-parent").find(".time-left").val();$(this).FlipClock(a,{countdown:!0})});$(".small-counter").each(function(){var a=$(this).parents(".timer-parent").find(".time-left").val();$(this).FlipClock(a,{countdown:!0})});var u=function(a,b){$(".rewarded-points-wrapper").fadeOut(300);var c=$(".menu-point-counter"),d=parseInt(c.text())+a;c.clearQueue();$(".current-points-wrapper").fadeOut(300);
$(".points-number-wrapper").animate({width:$(".points-number-wrapper").css("max-width")},300,function(){$(".rewarded-points-message").text(b);$(".rewarded-points-number").text("+"+a);$(".rewarded-points-wrapper").fadeIn(300);$(".menu-point-counter").text(d)})},t=function(a,b){var c=5E3*a.length;0<a.length&&(u(b[0],a[0]),1<a.length&&(setTimeout(function(){u(b[1],a[1])},5E3),2<a.length&&setTimeout(function(){u(b[2],a[2])},1E4)));setTimeout(function(){$(".rewarded-points-wrapper").fadeOut(300,function(){$(".points-number-wrapper").css("width",
"auto");$(".current-points-wrapper").fadeIn(300)})},c)};$(document).on("mouseenter",".active-rating-star",function(){$(this).prevAll(".active-rating-star").addClass("active-full-star");$(this).nextAll(".active-rating-star").addClass("active-no-star");$(this).addClass("active-full-star")});$(document).on("mouseleave",".active-rating-star",function(){$(this).prevAll(".active-rating-star").removeClass("active-full-star");$(this).nextAll(".active-rating-star").removeClass("active-no-star");$(this).removeClass("active-full-star")});
$(document).on("click",".active-rating-star",function(){var a=$(".challenge-id").val(),b=$(".active-full-star").size(),c=$(this);$(document).off("mouseenter",".active-rating-star");$(document).off("mouseleave",".active-rating-star");$(document).off("click",".active-rating-star");jsRoutes.controllers.Application.ajaxRateChallenge(a,b).ajax({success:function(a){c.parents("div").tooltip("destroy")}})});$(".new-comment-form").submit(function(a){a.preventDefault();a=!1;0==$("textarea[name='message']").val().length?
(alertify.error("If you want to post a comment, write it first -_-"),a=!0):250<$("textarea[name='message']").val().length&&(alertify.error("Only 250 characters allowed. It's just a comment, not a poem ;]"),a=!0);a||$(this).ajaxSubmit({success:function(a){if(jQuery.parseJSON(a).hasOwnProperty("status")){a=$(".comments-block");var c="",d=$("#current-username").val(),e=$("#menu-wrapper").find("img.smallProfilePicture").attr("src"),f=$(".new-comment-form").find("textarea").val(),c=c+('<div class="comment newly-added-comment" style="display: none"><div class="comment-author"><a href="'+
jsRoutes.controllers.Application.showProfile(d).url+'"><img class="smallProfilePicture" src="'+e+'"/>'+d+'</a></div><div class="comment-message">'+f+"</div></div>");a.prepend(c);a.find(".newly-added-comment").show("slow");$(".new-comment").find("textarea").val("")}else{var m=jQuery.parseJSON(a);$.each(m,function(a){var b=m[a];$.each(b,function(a){alertify.error(b[a].message)})})}}})});$(document).on("click",".show-more-participants",function(){var a=$(this),b=$(".current-challenge-id").val(),c=$(".current-offset").val(),
d=parseInt(c)+1,e=$("#participants-number").val(),f=$("#current-participants-number");jsRoutes.controllers.Application.ajaxShowMoreParticipants(b,c).ajax({success:function(b){$(".remove-participant").size();var c=$(".challenge-participants-wrapper").find("table tbody");$(".current-offset").val(d);c.append(b);c.find(".appended-row").show("normal");f.val(c.find("tr").length);$(".has-tooltip").tooltip();$(".small-counter").not(".flip-clock-wrapper").each(function(){var a=$(this).parents(".timer-parent").find(".time-left").val();
$(this).FlipClock(a,{countdown:!0})});e<=f.val()&&a.hide()}})});$(document).on("click",".show-more-participations",function(){var a=$(this),b=$(".current-offset").val(),c=parseInt(b)+1,d=$("#participations-number").val(),e=$("#current-participations-number"),f=$(".padded-glyph-challenges-wrapper");jsRoutes.controllers.Application.ajaxShowMoreParticipations(b).ajax({success:function(b){$(".current-offset").val(c);f.append(b);f.find(".padded-glyph-challenge").show("normal");e.val(f.find(".padded-glyph-challenge").length);
d<=e.val()&&a.hide();$(".has-tooltip").tooltip();$(".counter").not(".flip-clock-wrapper").each(function(){var a=$(this).parents(".padded-glyph-challenge").find(".time-left").val();$(this).FlipClock(a,{countdown:!0})})}})});$(document).on("click",".show-more-challenges",function(){var a=$(this),b=$(".current-offset").val(),c=parseInt(b)+1,d=$("#challenges-number").val(),e=$("#current-challenges-number"),f=$(".padded-glyph-challenges-wrapper");jsRoutes.controllers.Application.ajaxShowMoreChallenges(b).ajax({success:function(b){$(".current-offset").val(c);
f.append(b);f.find(".padded-glyph-challenge").show("normal");e.val(f.find(".padded-glyph-challenge").length);d<=e.val()&&a.hide();$(".has-tooltip").tooltip()}})});$(document).on("click",".show-more-comments",function(){var a=$(this),b=$(".current-offset").val(),c=parseInt(b)+1,d=$("#comments-number").val(),e=$("#current-comments-number"),f=$(".comments-block"),m=$(".current-challenge-id").val();jsRoutes.controllers.Application.ajaxShowMoreComments(m,b).ajax({success:function(b){$(".current-offset").val(c);
f.append(b);f.find(".comment").show("normal");e.val(f.find(".comment").length);d<=e.val()&&a.hide()}})});$(document).on("click",".show-more-notifications",function(){var a=$(this),b=$(".current-offset").val(),c=parseInt(b)+1,d=$("#notifications-number").val(),e=$("#current-notifications-number"),f=$(".user-notification-wrapper").find("table tbody");jsRoutes.controllers.Application.ajaxShowMoreNotifications(b).ajax({success:function(b){$(".current-offset").val(c);f.append(b);f.find("tr").show("normal");
e.val(f.find("tr").length);d<=e.val()&&a.hide()}})});$(".share-action").click(function(a){FB.ui({method:"apprequests",message:"Hey, check out this app. And I'm not just saying it because I'm an automatic message :P"},function(a){});a.preventDefault()})});$(window).load(function(){var g=$(".ui-block");g.css("height",g.width()/1.2);g.show()});
